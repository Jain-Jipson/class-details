<!DOCTYPE html>
<html>
<head>
  <title>Class Registration</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      margin: 20px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Class Registration</h1>

    <div id="class-list">
      <h2>Classes</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Class</th>
            <th>Division</th>
            <th>Teacher</th>
            <th>Strength</th>
            <th>Direction</th>
          </tr>
        </thead>
        <tbody>
          </tbody>
      </table>
    </div>

    <button id="add-class-btn" class="btn btn-primary">+</button>

    <div id="class-form" style="display: none;">
      <h2>Add Class</h2>
      <form id="class-form-data">
        <div class="form-group">
          <label for="class">Class:</label>
          <input type="text" class="form-control" id="class" name="class" required>
        </div>
        <div class="form-group">
          <label for="division">Division:</label>
          <input type="text" class="form-control" id="division" name="division" required>
        </div>
        <div class="form-group">
          <label for="teacher">Teacher:</label>
          <input type="text" class="form-control" id="teacher" name="teacher" required>
        </div>
        <div class="form-group">
          <label for="strength">Strength:</label>
          <input type="number" class="form-control" id="strength" name="strength" required>
        </div>
        <div class="form-group">
          <label for="direction">Direction:</label>
          <input type="text" class="form-control" id="direction" name="direction" required>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
        <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
      </form>
    </div>

  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    $(document).ready(function() {
      // Google Sheets API client ID and scopes
      const CLIENT_ID = '343673447773-os3mu6oc777eh0548se2litvi71hl3s2.apps.googleusercontent.com'; // Replace with your actual client ID
      const SCOPES = ['https://www.googleapis.com/auth/spreadsheets'];

      // Function to load existing classes from Google Sheet
      function loadClasses() {
        // Replace with your actual spreadsheet ID and sheet name
        const spreadsheetId = '1kIfGmABjh_cJxTSkCGr4R6QFTG-apJ2FAt0QARVjB5c';
        const sheetName = 'ClassDetails'; // Adjust sheet name if needed

        // Build the request URL
        const url = `https://sheets.googleapis.com/v4/spreadsheets/1kIfGmABjh_cJxTSkCGr4R6QFTG-apJ2FAt0QARVjB5c`;

        $.ajax({
          url: url,
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${accessToken}`
          },
          success: function(response) {
            const data = response.values;
            let tableBody = '';

            if (data && data.length > 0) {
              for (let i = 1; i < data.length; i++) { // Skip header row
                const row = data[i];
                tableBody += `
                  <tr>
                    <td>${row[0]}</td>
                    <td>${row[1]}</td>
                    <td>${row[2]}</td>
                    <td>${row[3]}</td>
                    <td>${row[4]}</td>
                  </tr>
                `;
              }
            } else {
              tableBody = '<tr><td colspan="5">No data found.</td></tr>';
            }

            $('#class-list table tbody').html(tableBody);
          },
          error: function(xhr, status, error) {
            console.error('Error loading classes:', error);
            // Handle error, e.g., display an error message to the user
          }
        });
      }

      // Function to add a new class to Google Sheet
      function addClass(data) {
        // Replace with your actual spreadsheet ID and sheet name
        const spreadsheetId = '1kIfGmABjh_cJxTSkCGr4R6QFTG-apJ2FAt0QARVjB5c';
        const sheetName = 'ClassDetails';

        const url = `https://sheets.googleapis.com/v4/spreadsheets/1kIfGmABjh_cJxTSkCGr4R6QFTG-apJ2FAt0QARVjB5c/values/ClassDetails:append?valueInputOption=RAW`;

        $.ajax({
          url: url,
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          data: JSON.stringify({
            values: [ 
              [ 
                'New Class', // Replace with actual data
                'A', 
                'Teacher Name', 
                '30', 
                'Room 101' 
              ] 
            ]
          }),
          success: function() {
            console.log('Class added successfully!'); 
          },
          error: function(xhr, status, error) {
            console.error('Error adding class:', error, xhr.responseText); 
          }
        });
      }

      // Handle button clicks
      $('#add-class-btn').click(function() {
        $('#class-form').show();
      });

      $('#cancel-btn').click(function() {
        $('#class-form').hide();
      });

      $('#class-form-data').submit(function(event) {
        event.preventDefault();

        const classData = {
          class: $('#class').val(),
          division: $('#division').val(),
          teacher: $('#teacher').val(),
          strength: $('#strength').val(),
          direction: $('#direction').val()
        };

        addClass(classData);
      });

      // Handle OAuth2 flow (replace with your actual implementation)
      // 1. Obtain authorization code from Google's OAuth 2.0 endpoint
      // 2. Exchange authorization code for access token
      // 3. Store access token (e.g., in local storage)
      // 4. Use access token in API requests

      // Example: (Replace with your actual OAuth2 implementation)
      let accessToken = localStorage.getItem('accessToken');

      if (!accessToken) {
        // If no access token, redirect to OAuth 2.0 consent screen
        window.location.href = `https://accounts.google.com/o/oauth2/v2/auth?client_id=343673447773-os3mu6oc777eh0548se2litvi71hl3s2.apps.googleusercontent.com&redirect_uri=https://jain-jipson.github.io/class-details/&scope=https://www.googleapis.com/auth/spreadsheets&response_type=code`; 
      } else {
        // Load existing classes
        loadClasses();
      }

      // Handle token refresh (if necessary)
      // ...

    });
  </script>

</body>
</html>